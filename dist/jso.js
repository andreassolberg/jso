!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.jso=t():e.jso=t()}(window,function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=98)}([function(e,t,n){(function(t){var n="object",r=function(e){return e&&e.Math==Math&&e};e.exports=r(typeof globalThis==n&&globalThis)||r(typeof window==n&&window)||r(typeof self==n&&self)||r(typeof t==n&&t)||Function("return this")()}).call(this,n(61))},function(e,t,n){var r=n(0),o=n(17),i=n(41),u=n(67),c=r.Symbol,a=o("wks");e.exports=function(e){return a[e]||(a[e]=u&&c[e]||(u?c:i)("Symbol."+e))}},function(e,t,n){var r=n(0),o=n(22).f,i=n(3),u=n(16),c=n(25),a=n(63),s=n(46);e.exports=function(e,t){var n,f,l,p,h,v=e.target,d=e.global,y=e.stat;if(n=d?r:y?r[v]||c(v,{}):(r[v]||{}).prototype)for(f in t){if(p=t[f],l=e.noTargetGet?(h=o(n,f))&&h.value:n[f],!s(d?f:v+(y?".":"#")+f,e.forced)&&void 0!==l){if(typeof p==typeof l)continue;a(p,l)}(e.sham||l&&l.sham)&&i(p,"sham",!0),u(n,f,p,e)}}},function(e,t,n){var r=n(7),o=n(11),i=n(14);e.exports=r?function(e,t,n){return o.f(e,t,i(1,n))}:function(e,t,n){return e[t]=n,e}},function(e,t,n){var r=n(8);e.exports=function(e){if(!r(e))throw TypeError(String(e)+" is not an object");return e}},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t){var n={}.hasOwnProperty;e.exports=function(e,t){return n.call(e,t)}},function(e,t,n){var r=n(5);e.exports=!r(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e}},function(e,t){var n={}.toString;e.exports=function(e){return n.call(e).slice(8,-1)}},function(e,t,n){var r=n(7),o=n(39),i=n(4),u=n(38),c=Object.defineProperty;t.f=r?c:function(e,t,n){if(i(e),t=u(t,!0),i(n),o)try{return c(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(e[t]=n.value),e}},function(e,t){e.exports={}},function(e,t,n){"use strict";var r=n(9),o=function(e){var t,n;this.promise=new e(function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r}),this.resolve=r(t),this.reject=r(n)};e.exports.f=function(e){return new o(e)}},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,n){var r=n(37),o=n(23);e.exports=function(e){return r(o(e))}},function(e,t,n){var r=n(0),o=n(17),i=n(3),u=n(6),c=n(25),a=n(40),s=n(19),f=s.get,l=s.enforce,p=String(a).split("toString");o("inspectSource",function(e){return a.call(e)}),(e.exports=function(e,t,n,o){var a=!!o&&!!o.unsafe,s=!!o&&!!o.enumerable,f=!!o&&!!o.noTargetGet;"function"==typeof n&&("string"!=typeof t||u(n,"name")||i(n,"name",t),l(n).source=p.join("string"==typeof t?t:"")),e!==r?(a?!f&&e[t]&&(s=!0):delete e[t],s?e[t]=n:i(e,t,n)):s?e[t]=n:c(t,n)})(Function.prototype,"toString",function(){return"function"==typeof this&&f(this).source||a.call(this)})},function(e,t,n){var r=n(0),o=n(25),i=n(18),u=r["__core-js_shared__"]||o("__core-js_shared__",{});(e.exports=function(e,t){return u[e]||(u[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.1.3",mode:i?"pure":"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})},function(e,t){e.exports=!1},function(e,t,n){var r,o,i,u=n(62),c=n(0),a=n(8),s=n(3),f=n(6),l=n(26),p=n(27),h=c.WeakMap;if(u){var v=new h,d=v.get,y=v.has,g=v.set;r=function(e,t){return g.call(v,e,t),t},o=function(e){return d.call(v,e)||{}},i=function(e){return y.call(v,e)}}else{var b=l("state");p[b]=!0,r=function(e,t){return s(e,b,t),t},o=function(e){return f(e,b)?e[b]:{}},i=function(e){return f(e,b)}}e.exports={set:r,get:o,has:i,enforce:function(e){return i(e)?o(e):r(e,{})},getterFor:function(e){return function(t){var n;if(!a(t)||(n=o(t)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return n}}}},function(e,t,n){var r=n(4),o=n(75),i=n(44),u=n(51),c=n(76),a=n(77),s={};(e.exports=function(e,t,n,f,l){var p,h,v,d,y,g=u(t,n,f?2:1);if(l)p=e;else{if("function"!=typeof(h=c(e)))throw TypeError("Target is not iterable");if(o(h)){for(v=0,d=i(e.length);d>v;v++)if((f?g(r(y=e[v])[0],y[1]):g(e[v]))===s)return s;return}p=h.call(e)}for(;!(y=p.next()).done;)if(a(p,g,y.value,f)===s)return s}).BREAK=s},function(e,t){e.exports=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}}},function(e,t,n){var r=n(7),o=n(36),i=n(14),u=n(15),c=n(38),a=n(6),s=n(39),f=Object.getOwnPropertyDescriptor;t.f=r?f:function(e,t){if(e=u(e),t=c(t,!0),s)try{return f(e,t)}catch(e){}if(a(e,t))return i(!o.f.call(e,t),e[t])}},function(e,t){e.exports=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e}},function(e,t,n){var r=n(0),o=n(8),i=r.document,u=o(i)&&o(i.createElement);e.exports=function(e){return u?i.createElement(e):{}}},function(e,t,n){var r=n(0),o=n(3);e.exports=function(e,t){try{o(r,e,t)}catch(n){r[e]=t}return t}},function(e,t,n){var r=n(17),o=n(41),i=r("keys");e.exports=function(e){return i[e]||(i[e]=o(e))}},function(e,t){e.exports={}},function(e,t){var n=Math.ceil,r=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?r:n)(e)}},function(e,t){e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},function(e,t,n){var r=n(4),o=n(68),i=n(29),u=n(27),c=n(49),a=n(24),s=n(26)("IE_PROTO"),f=function(){},l=function(){var e,t=a("iframe"),n=i.length;for(t.style.display="none",c.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),l=e.F;n--;)delete l.prototype[i[n]];return l()};e.exports=Object.create||function(e,t){var n;return null!==e?(f.prototype=r(e),n=new f,f.prototype=null,n[s]=e):n=l(),void 0===t?n:o(n,t)},u[s]=!0},function(e,t,n){e.exports=n(0)},function(e,t,n){var r=n(11).f,o=n(6),i=n(1)("toStringTag");e.exports=function(e,t,n){e&&!o(e=n?e:e.prototype,i)&&r(e,i,{configurable:!0,value:t})}},function(e,t,n){var r=n(31),o=n(0),i=function(e){return"function"==typeof e?e:void 0};e.exports=function(e,t){return arguments.length<2?i(r[e])||i(o[e]):r[e]&&r[e][t]||o[e]&&o[e][t]}},function(e,t,n){var r=n(6),o=n(58),i=n(26),u=n(85),c=i("IE_PROTO"),a=Object.prototype;e.exports=u?Object.getPrototypeOf:function(e){return e=o(e),r(e,c)?e[c]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?a:null}},function(e,t,n){e.exports=n(94)},function(e,t,n){"use strict";var r={}.propertyIsEnumerable,o=Object.getOwnPropertyDescriptor,i=o&&!r.call({1:2},1);t.f=i?function(e){var t=o(this,e);return!!t&&t.enumerable}:r},function(e,t,n){var r=n(5),o=n(10),i="".split;e.exports=r(function(){return!Object("z").propertyIsEnumerable(0)})?function(e){return"String"==o(e)?i.call(e,""):Object(e)}:Object},function(e,t,n){var r=n(8);e.exports=function(e,t){if(!r(e))return e;var n,o;if(t&&"function"==typeof(n=e.toString)&&!r(o=n.call(e)))return o;if("function"==typeof(n=e.valueOf)&&!r(o=n.call(e)))return o;if(!t&&"function"==typeof(n=e.toString)&&!r(o=n.call(e)))return o;throw TypeError("Can't convert object to primitive value")}},function(e,t,n){var r=n(7),o=n(5),i=n(24);e.exports=!r&&!o(function(){return 7!=Object.defineProperty(i("div"),"a",{get:function(){return 7}}).a})},function(e,t,n){var r=n(17);e.exports=r("native-function-to-string",Function.toString)},function(e,t){var n=0,r=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++n+r).toString(36))}},function(e,t,n){var r=n(6),o=n(15),i=n(43),u=n(27),c=i(!1);e.exports=function(e,t){var n,i=o(e),a=0,s=[];for(n in i)!r(u,n)&&r(i,n)&&s.push(n);for(;t.length>a;)r(i,n=t[a++])&&(~c(s,n)||s.push(n));return s}},function(e,t,n){var r=n(15),o=n(44),i=n(66);e.exports=function(e){return function(t,n,u){var c,a=r(t),s=o(a.length),f=i(u,s);if(e&&n!=n){for(;s>f;)if((c=a[f++])!=c)return!0}else for(;s>f;f++)if((e||f in a)&&a[f]===n)return e||f||0;return!e&&-1}}},function(e,t,n){var r=n(28),o=Math.min;e.exports=function(e){return e>0?o(r(e),9007199254740991):0}},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t,n){var r=n(5),o=/#|\.prototype\./,i=function(e,t){var n=c[u(e)];return n==s||n!=a&&("function"==typeof t?r(t):!!t)},u=i.normalize=function(e){return String(e).replace(o,".").toLowerCase()},c=i.data={},a=i.NATIVE="N",s=i.POLYFILL="P";e.exports=i},function(e,t,n){var r=n(1),o=n(30),i=n(3),u=r("unscopables"),c=Array.prototype;null==c[u]&&i(c,u,o(null)),e.exports=function(e){c[u][e]=!0}},function(e,t,n){var r=n(42),o=n(29);e.exports=Object.keys||function(e){return r(e,o)}},function(e,t,n){var r=n(0).document;e.exports=r&&r.documentElement},function(e,t,n){var r=n(10),o=n(1)("toStringTag"),i="Arguments"==r(function(){return arguments}());e.exports=function(e){var t,n,u;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),o))?n:i?r(t):"Object"==(u=r(t))&&"function"==typeof t.callee?"Arguments":u}},function(e,t,n){var r=n(9);e.exports=function(e,t,n){if(r(e),void 0===t)return e;switch(n){case 0:return function(){return e.call(t)};case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,o){return e.call(t,n,r,o)}}return function(){return e.apply(t,arguments)}}},function(e,t,n){var r=n(4),o=n(9),i=n(1)("species");e.exports=function(e,t){var n,u=r(e).constructor;return void 0===u||null==(n=r(u)[i])?t:o(n)}},function(e,t,n){var r,o,i,u=n(0),c=n(5),a=n(10),s=n(51),f=n(49),l=n(24),p=u.location,h=u.setImmediate,v=u.clearImmediate,d=u.process,y=u.MessageChannel,g=u.Dispatch,b=0,m={},w=function(e){if(m.hasOwnProperty(e)){var t=m[e];delete m[e],t()}},x=function(e){return function(){w(e)}},O=function(e){w(e.data)},k=function(e){u.postMessage(e+"",p.protocol+"//"+p.host)};h&&v||(h=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return m[++b]=function(){("function"==typeof e?e:Function(e)).apply(void 0,t)},r(b),b},v=function(e){delete m[e]},"process"==a(d)?r=function(e){d.nextTick(x(e))}:g&&g.now?r=function(e){g.now(x(e))}:y?(i=(o=new y).port2,o.port1.onmessage=O,r=s(i.postMessage,i,1)):!u.addEventListener||"function"!=typeof postMessage||u.importScripts||c(k)?r="onreadystatechange"in l("script")?function(e){f.appendChild(l("script")).onreadystatechange=function(){f.removeChild(this),w(e)}}:function(e){setTimeout(x(e),0)}:(r=k,u.addEventListener("message",O,!1))),e.exports={set:h,clear:v}},function(e,t,n){var r=n(0).navigator;e.exports=r&&r.userAgent||""},function(e,t,n){var r=n(4),o=n(8),i=n(13);e.exports=function(e,t){if(r(e),o(t)&&t.constructor===e)return t;var n=i.f(e);return(0,n.resolve)(t),n.promise}},function(e,t,n){"use strict";var r=n(2),o=n(84),i=n(34),u=n(59),c=n(32),a=n(3),s=n(16),f=n(1),l=n(18),p=n(12),h=n(57),v=h.IteratorPrototype,d=h.BUGGY_SAFARI_ITERATORS,y=f("iterator"),g=function(){return this};e.exports=function(e,t,n,f,h,b,m){o(n,t,f);var w,x,O,k=function(e){if(e===h&&T)return T;if(!d&&e in _)return _[e];switch(e){case"keys":case"values":case"entries":return function(){return new n(this,e)}}return function(){return new n(this)}},j=t+" Iterator",S=!1,_=e.prototype,P=_[y]||_["@@iterator"]||h&&_[h],T=!d&&P||k(h),E="Array"==t&&_.entries||P;if(E&&(w=i(E.call(new e)),v!==Object.prototype&&w.next&&(l||i(w)===v||(u?u(w,v):"function"!=typeof w[y]&&a(w,y,g)),c(w,j,!0,!0),l&&(p[j]=g))),"values"==h&&P&&"values"!==P.name&&(S=!0,T=function(){return P.call(this)}),l&&!m||_[y]===T||a(_,y,T),p[t]=T,h)if(x={values:k("values"),keys:b?T:k("keys"),entries:k("entries")},m)for(O in x)!d&&!S&&O in _||s(_,O,x[O]);else r({target:t,proto:!0,forced:d||S},x);return x}},function(e,t,n){"use strict";var r,o,i,u=n(34),c=n(3),a=n(6),s=n(1),f=n(18),l=s("iterator"),p=!1;[].keys&&("next"in(i=[].keys())?(o=u(u(i)))!==Object.prototype&&(r=o):p=!0),null==r&&(r={}),f||a(r,l)||c(r,l,function(){return this}),e.exports={IteratorPrototype:r,BUGGY_SAFARI_ITERATORS:p}},function(e,t,n){var r=n(23);e.exports=function(e){return Object(r(e))}},function(e,t,n){var r=n(86);e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(n,[]),t=n instanceof Array}catch(e){}return function(n,o){return r(n,o),t?e.call(n,o):n.__proto__=o,n}}():void 0)},function(e,t,n){"use strict";var r=n(2),o=n(43),i=n(47),u=o(!0);r({target:"Array",proto:!0},{includes:function(e){return u(this,e,arguments.length>1?arguments[1]:void 0)}}),i("includes")},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){var r=n(0),o=n(40),i=r.WeakMap;e.exports="function"==typeof i&&/native code/.test(o.call(i))},function(e,t,n){var r=n(6),o=n(64),i=n(22),u=n(11);e.exports=function(e,t){for(var n=o(t),c=u.f,a=i.f,s=0;s<n.length;s++){var f=n[s];r(e,f)||c(e,f,a(t,f))}}},function(e,t,n){var r=n(0),o=n(65),i=n(45),u=n(4),c=r.Reflect;e.exports=c&&c.ownKeys||function(e){var t=o.f(u(e)),n=i.f;return n?t.concat(n(e)):t}},function(e,t,n){var r=n(42),o=n(29).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return r(e,o)}},function(e,t,n){var r=n(28),o=Math.max,i=Math.min;e.exports=function(e,t){var n=r(e);return n<0?o(n+t,0):i(n,t)}},function(e,t,n){var r=n(5);e.exports=!!Object.getOwnPropertySymbols&&!r(function(){return!String(Symbol())})},function(e,t,n){var r=n(7),o=n(11),i=n(4),u=n(48);e.exports=r?Object.defineProperties:function(e,t){i(e);for(var n,r=u(t),c=r.length,a=0;c>a;)o.f(e,n=r[a++],t[n]);return e}},function(e,t,n){var r=n(16),o=n(70),i=Object.prototype;o!==i.toString&&r(i,"toString",o,{unsafe:!0})},function(e,t,n){"use strict";var r=n(50),o={};o[n(1)("toStringTag")]="z",e.exports="[object z]"!==String(o)?function(){return"[object "+r(this)+"]"}:o.toString},function(e,t,n){"use strict";var r,o,i,u=n(2),c=n(18),a=n(0),s=n(31),f=n(72),l=n(32),p=n(73),h=n(8),v=n(9),d=n(74),y=n(10),g=n(20),b=n(78),m=n(52),w=n(53).set,x=n(79),O=n(55),k=n(80),j=n(13),S=n(21),_=n(54),P=n(19),T=n(46),E=n(1)("species"),C="Promise",L=P.get,R=P.set,I=P.getterFor(C),A=a.Promise,q=a.TypeError,M=a.document,D=a.process,V=a.fetch,z=D&&D.versions,F=z&&z.v8||"",N=j.f,U=N,J="process"==y(D),B=!!(M&&M.createEvent&&a.dispatchEvent),G=T(C,function(){var e=A.resolve(1),t=function(){},n=(e.constructor={})[E]=function(e){e(t,t)};return!((J||"function"==typeof PromiseRejectionEvent)&&(!c||e.finally)&&e.then(t)instanceof n&&0!==F.indexOf("6.6")&&-1===_.indexOf("Chrome/66"))}),H=G||!b(function(e){A.all(e).catch(function(){})}),W=function(e){var t;return!(!h(e)||"function"!=typeof(t=e.then))&&t},Q=function(e,t,n){if(!t.notified){t.notified=!0;var r=t.reactions;x(function(){for(var o=t.value,i=1==t.state,u=0,c=function(n){var r,u,c,a=i?n.ok:n.fail,s=n.resolve,f=n.reject,l=n.domain;try{a?(i||(2===t.rejection&&Z(e,t),t.rejection=1),!0===a?r=o:(l&&l.enter(),r=a(o),l&&(l.exit(),c=!0)),r===n.promise?f(q("Promise-chain cycle")):(u=W(r))?u.call(r,s,f):s(r)):f(o)}catch(e){l&&!c&&l.exit(),f(e)}};r.length>u;)c(r[u++]);t.reactions=[],t.notified=!1,n&&!t.rejection&&Y(e,t)})}},K=function(e,t,n){var r,o;B?((r=M.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),a.dispatchEvent(r)):r={promise:t,reason:n},(o=a["on"+e])?o(r):"unhandledrejection"===e&&k("Unhandled promise rejection",n)},Y=function(e,t){w.call(a,function(){var n,r=t.value;if(X(t)&&(n=S(function(){J?D.emit("unhandledRejection",r,e):K("unhandledrejection",e,r)}),t.rejection=J||X(t)?2:1,n.error))throw n.value})},X=function(e){return 1!==e.rejection&&!e.parent},Z=function(e,t){w.call(a,function(){J?D.emit("rejectionHandled",e):K("rejectionhandled",e,t.value)})},$=function(e,t,n,r){return function(o){e(t,n,o,r)}},ee=function(e,t,n,r){t.done||(t.done=!0,r&&(t=r),t.value=n,t.state=2,Q(e,t,!0))},te=function(e,t,n,r){if(!t.done){t.done=!0,r&&(t=r);try{if(e===n)throw q("Promise can't be resolved itself");var o=W(n);o?x(function(){var r={done:!1};try{o.call(n,$(te,e,r,t),$(ee,e,r,t))}catch(n){ee(e,r,n,t)}}):(t.value=n,t.state=1,Q(e,t,!1))}catch(n){ee(e,{done:!1},n,t)}}};G&&(A=function(e){d(this,A,C),v(e),r.call(this);var t=L(this);try{e($(te,this,t),$(ee,this,t))}catch(e){ee(this,t,e)}},(r=function(e){R(this,{type:C,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=f(A.prototype,{then:function(e,t){var n=I(this),r=N(m(this,A));return r.ok="function"!=typeof e||e,r.fail="function"==typeof t&&t,r.domain=J?D.domain:void 0,n.parent=!0,n.reactions.push(r),0!=n.state&&Q(this,n,!1),r.promise},catch:function(e){return this.then(void 0,e)}}),o=function(){var e=new r,t=L(e);this.promise=e,this.resolve=$(te,e,t),this.reject=$(ee,e,t)},j.f=N=function(e){return e===A||e===i?new o(e):U(e)},c||"function"!=typeof V||u({global:!0,enumerable:!0,forced:!0},{fetch:function(e){return O(A,V.apply(a,arguments))}})),u({global:!0,wrap:!0,forced:G},{Promise:A}),l(A,C,!1,!0),p(C),i=s.Promise,u({target:C,stat:!0,forced:G},{reject:function(e){var t=N(this);return t.reject.call(void 0,e),t.promise}}),u({target:C,stat:!0,forced:c||G},{resolve:function(e){return O(c&&this===i?A:this,e)}}),u({target:C,stat:!0,forced:H},{all:function(e){var t=this,n=N(t),r=n.resolve,o=n.reject,i=S(function(){var n=v(t.resolve),i=[],u=0,c=1;g(e,function(e){var a=u++,s=!1;i.push(void 0),c++,n.call(t,e).then(function(e){s||(s=!0,i[a]=e,--c||r(i))},o)}),--c||r(i)});return i.error&&o(i.value),n.promise},race:function(e){var t=this,n=N(t),r=n.reject,o=S(function(){var o=v(t.resolve);g(e,function(e){o.call(t,e).then(n.resolve,r)})});return o.error&&r(o.value),n.promise}})},function(e,t,n){var r=n(16);e.exports=function(e,t,n){for(var o in t)r(e,o,t[o],n);return e}},function(e,t,n){"use strict";var r=n(33),o=n(11),i=n(1),u=n(7),c=i("species");e.exports=function(e){var t=r(e),n=o.f;u&&t&&!t[c]&&n(t,c,{configurable:!0,get:function(){return this}})}},function(e,t){e.exports=function(e,t,n){if(!(e instanceof t))throw TypeError("Incorrect "+(n?n+" ":"")+"invocation");return e}},function(e,t,n){var r=n(1),o=n(12),i=r("iterator"),u=Array.prototype;e.exports=function(e){return void 0!==e&&(o.Array===e||u[i]===e)}},function(e,t,n){var r=n(50),o=n(12),i=n(1)("iterator");e.exports=function(e){if(null!=e)return e[i]||e["@@iterator"]||o[r(e)]}},function(e,t,n){var r=n(4);e.exports=function(e,t,n,o){try{return o?t(r(n)[0],n[1]):t(n)}catch(t){var i=e.return;throw void 0!==i&&r(i.call(e)),t}}},function(e,t,n){var r=n(1)("iterator"),o=!1;try{var i=0,u={next:function(){return{done:!!i++}},return:function(){o=!0}};u[r]=function(){return this},Array.from(u,function(){throw 2})}catch(e){}e.exports=function(e,t){if(!t&&!o)return!1;var n=!1;try{var i={};i[r]=function(){return{next:function(){return{done:n=!0}}}},e(i)}catch(e){}return n}},function(e,t,n){var r,o,i,u,c,a,s,f=n(0),l=n(22).f,p=n(10),h=n(53).set,v=n(54),d=f.MutationObserver||f.WebKitMutationObserver,y=f.process,g=f.Promise,b="process"==p(y),m=l(f,"queueMicrotask"),w=m&&m.value;w||(r=function(){var e,t;for(b&&(e=y.domain)&&e.exit();o;){t=o.fn,o=o.next;try{t()}catch(e){throw o?u():i=void 0,e}}i=void 0,e&&e.enter()},b?u=function(){y.nextTick(r)}:d&&!/(iphone|ipod|ipad).*applewebkit/i.test(v)?(c=!0,a=document.createTextNode(""),new d(r).observe(a,{characterData:!0}),u=function(){a.data=c=!c}):g&&g.resolve?(s=g.resolve(void 0),u=function(){s.then(r)}):u=function(){h.call(f,r)}),e.exports=w||function(e){var t={fn:e,next:void 0};i&&(i.next=t),o||(o=t,u()),i=t}},function(e,t,n){var r=n(0);e.exports=function(e,t){var n=r.console;n&&n.error&&(1===arguments.length?n.error(e):n.error(e,t))}},function(e,t,n){"use strict";var r=n(2),o=n(33),i=n(52),u=n(55);r({target:"Promise",proto:!0,real:!0},{finally:function(e){var t=i(this,o("Promise")),n="function"==typeof e;return this.then(n?function(n){return u(t,e()).then(function(){return n})}:e,n?function(n){return u(t,e()).then(function(){throw n})}:e)}})},function(e,t,n){"use strict";var r=n(83),o=n(19),i=n(56),u=o.set,c=o.getterFor("String Iterator");i(String,"String",function(e){u(this,{type:"String Iterator",string:String(e),index:0})},function(){var e,t=c(this),n=t.string,o=t.index;return o>=n.length?{value:void 0,done:!0}:(e=r(n,o,!0),t.index+=e.length,{value:e,done:!1})})},function(e,t,n){var r=n(28),o=n(23);e.exports=function(e,t,n){var i,u,c=String(o(e)),a=r(t),s=c.length;return a<0||a>=s?n?"":void 0:(i=c.charCodeAt(a))<55296||i>56319||a+1===s||(u=c.charCodeAt(a+1))<56320||u>57343?n?c.charAt(a):i:n?c.slice(a,a+2):u-56320+(i-55296<<10)+65536}},function(e,t,n){"use strict";var r=n(57).IteratorPrototype,o=n(30),i=n(14),u=n(32),c=n(12),a=function(){return this};e.exports=function(e,t,n){var s=t+" Iterator";return e.prototype=o(r,{next:i(1,n)}),u(e,s,!1,!0),c[s]=a,e}},function(e,t,n){var r=n(5);e.exports=!r(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})},function(e,t,n){var r=n(8),o=n(4);e.exports=function(e,t){if(o(e),!r(t)&&null!==t)throw TypeError("Can't set "+String(t)+" as a prototype")}},function(e,t,n){var r=n(2),o=n(34),i=n(59),u=n(30),c=n(14),a=n(20),s=n(3),f=function(e,t){var n=this;if(!(n instanceof f))return new f(e,t);i&&(n=i(new Error(t),o(n)));var r=[];return a(e,r.push,r),n.errors=r,void 0!==t&&s(n,"message",String(t)),n};f.prototype=u(Error.prototype,{constructor:c(5,f),name:c(5,"AggregateError")}),r({global:!0},{AggregateError:f})},function(e,t,n){"use strict";var r=n(2),o=n(9),i=n(13),u=n(21),c=n(20);r({target:"Promise",stat:!0},{allSettled:function(e){var t=this,n=i.f(t),r=n.resolve,a=n.reject,s=u(function(){var n=o(t.resolve),i=[],u=0,a=1;c(e,function(e){var o=u++,c=!1;i.push(void 0),a++,n.call(t,e).then(function(e){c||(c=!0,i[o]={status:"fulfilled",value:e},--a||r(i))},function(e){c||(c=!0,i[o]={status:"rejected",reason:e},--a||r(i))})}),--a||r(i)});return s.error&&a(s.value),n.promise}})},function(e,t,n){"use strict";var r=n(2),o=n(9),i=n(33),u=n(13),c=n(21),a=n(20);r({target:"Promise",stat:!0},{any:function(e){var t=this,n=u.f(t),r=n.resolve,s=n.reject,f=c(function(){var n=o(t.resolve),u=[],c=0,f=1,l=!1;a(e,function(e){var o=c++,a=!1;u.push(void 0),f++,n.call(t,e).then(function(e){a||l||(l=!0,r(e))},function(e){a||l||(a=!0,u[o]=e,--f||s(new(i("AggregateError"))(u,"No one promise resolved")))})}),--f||s(new(i("AggregateError"))(u,"No one promise resolved"))});return f.error&&s(f.value),n.promise}})},function(e,t,n){"use strict";var r=n(2),o=n(13),i=n(21);r({target:"Promise",stat:!0},{try:function(e){var t=o.f(this),n=i(e);return(n.error?t.reject:t.resolve)(n.value),t.promise}})},function(e,t,n){var r=n(0),o=n(92),i=n(93),u=n(3),c=n(1),a=c("iterator"),s=c("toStringTag"),f=i.values;for(var l in o){var p=r[l],h=p&&p.prototype;if(h){if(h[a]!==f)try{u(h,a,f)}catch(e){h[a]=f}if(h[s]||u(h,s,l),o[l])for(var v in i)if(h[v]!==i[v])try{u(h,v,i[v])}catch(e){h[v]=i[v]}}}},function(e,t){e.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},function(e,t,n){"use strict";var r=n(15),o=n(47),i=n(12),u=n(19),c=n(56),a=u.set,s=u.getterFor("Array Iterator");e.exports=c(Array,"Array",function(e,t){a(this,{type:"Array Iterator",target:r(e),index:0,kind:t})},function(){var e=s(this),t=e.target,n=e.kind,r=e.index++;return!t||r>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==n?{value:r,done:!1}:"values"==n?{value:t[r],done:!1}:{value:[r,t[r]],done:!1}},"values"),i.Arguments=i.Array,o("keys"),o("values"),o("entries")},function(e,t,n){n(95);var r=n(31);e.exports=r.Object.assign},function(e,t,n){var r=n(2),o=n(96);r({target:"Object",stat:!0,forced:Object.assign!==o},{assign:o})},function(e,t,n){"use strict";var r=n(7),o=n(5),i=n(48),u=n(45),c=n(36),a=n(58),s=n(37),f=Object.assign;e.exports=!f||o(function(){var e={},t={},n=Symbol();return e[n]=7,"abcdefghijklmnopqrst".split("").forEach(function(e){t[e]=e}),7!=f({},e)[n]||"abcdefghijklmnopqrst"!=i(f({},t)).join("")})?function(e,t){for(var n=a(e),o=arguments.length,f=1,l=u.f,p=c.f;o>f;)for(var h,v=s(arguments[f++]),d=l?i(v).concat(l(v)):i(v),y=d.length,g=0;y>g;)h=d[g++],r&&!p.call(v,h)||(n[h]=v[h]);return n}:f},function(e){e.exports={name:"jso",version:"4.1.1",description:"OAuth 2.0 implementation in Javascript",main:"dist/jso.js",module:"src/JSO.js",scripts:{test:"true",preversion:"npm test",version:"npm run build && git add -A dist",postversion:"git push && git push --tags && npm publish",build:"webpack --mode production --config webpack.config.js"},babel:{presets:[["@babel/preset-env",{targets:{browsers:["last 2 versions","> 5% in BE"],uglify:!0},debug:!0}]]},repository:{type:"git",url:"https://github.com/andreassolberg/jso.git"},keywords:["oauth","authentication","authorization","rest","api","ajax","jquery"],files:["src"],eslintConfig:{env:{es6:!0,browser:!0,node:!1}},devDependencies:{"@babel/core":"^7.4.5","@babel/preset-env":"^7.4.5","@babel/preset-react":"^7.0.0","babel-loader":"^8.0.6","core-js":"^3.1.3",qunit:"^2.5.1",webpack:"^4.1.1","webpack-cli":"^3.3.2"},author:"Andreas Åkre Solberg",license:"LGPL-2.1",bugs:{url:"https://github.com/andreassolberg/jso/issues"},homepage:"https://github.com/andreassolberg/jso",dependencies:{}}},function(e,t,n){"use strict";n.r(t);n(60),n(69),n(71),n(81),n(82),n(87),n(88),n(89),n(90),n(91);var r=n(35),o=n.n(r),i={epoch:function(){return Math.round((new Date).getTime()/1e3)},debug:!1,uuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})},getResponseFromURL:function(e){return-1!==e.indexOf("#")?i.parseQueryString(e.substring(e.indexOf("#")+1)):-1!==e.indexOf("?")?i.parseQueryString(e.substring(e.indexOf("?")+1)):{}},parseQueryString:function(e){for(var t,n=/\+/g,r=/([^&;=]+)=?([^&;]*)/g,o=function(e){return decodeURIComponent(e.replace(n," "))},i=e,u={};t=r.exec(i);)u[o(t[1])]=o(t[2]);return u},scopeList:function(e){return i.uniqueList(e).join(" ")},uniqueList:function(e){for(var t={},n=[],r=0;r<e.length;r++)t[e[r]]=1;for(var o in t)t.hasOwnProperty(o)&&n.push(o);return n},log:function(e){if(console&&console.log&&i.debug){var t=Array.prototype.slice.call(arguments);t.unshift("[JSO]"),console.log.apply(console,t)}},encodeQS:function(e){var t,n="",r=0;for(t in e)n+=(0==r++?"":"&")+encodeURIComponent(t)+"="+encodeURIComponent(e[t]);return n},encodeURL:function(e,t){var n,r=e,o=0,i=-1===e.indexOf("?")?"?":"&";for(n in t)r+=(0==o++?i:"&")+encodeURIComponent(n)+"="+encodeURIComponent(t[n]);return r}},u=i;function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,(n=[{key:"saveState",value:function(e,t){localStorage.setItem("state-"+e,JSON.stringify(t))}},{key:"getState",value:function(e){var t=JSON.parse(localStorage.getItem("state-"+e));return localStorage.removeItem("state-"+e),t}},{key:"hasScope",value:function(e,t){var n;if(!e.scopes)return!1;for(n=0;n<e.scopes.length;n++)if(e.scopes[n]===t)return!0;return!1}},{key:"filterTokens",value:function(e,t){var n,r,o,i=[],c=u.epoch();for(t||(t=[]),n=0;n<e.length;n++){for(o=!0,e[n].expires&&e[n].expires<c+1&&(o=!1),r=0;r<t.length;r++)this.hasScope(e[n],t[r])||(o=!1);o&&i.push(e[n])}return i}},{key:"saveTokens",value:function(e,t){localStorage.setItem("tokens-"+e,JSON.stringify(t))}},{key:"getTokens",value:function(e){var t=JSON.parse(localStorage.getItem("tokens-"+e));return t||(t=[]),u.log("Token found when loooking up provider "+e+" in store "+window.location.href,t),t}},{key:"wipeTokens",value:function(e){localStorage.removeItem("tokens-"+e)}},{key:"saveToken",value:function(e,t){var n=this.getTokens(e);(n=this.filterTokens(n)).push(t),this.saveTokens(e,n)}},{key:"getToken",value:function(e,t){var n=this.getTokens(e);return(n=this.filterTokens(n,t)).length<1?null:n[0]}}])&&c(t.prototype,n),r&&c(t,r),e}());function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var f=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),console.log("Initializing a loader with url "+t),this.url=t}var t,n,r;return t=e,(n=[{key:"execute",value:function(){}}])&&s(t.prototype,n),r&&s(t,r),e}();function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function h(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function v(e){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var y=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),h(this,v(t).apply(this,arguments))}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(t,f),n=t,(r=[{key:"execute",value:function(){var e=this;return new Promise(function(t,n){window.location=e.url})}}])&&p(n.prototype,r),o&&p(n,o),t}();function g(e){return(g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function m(e,t){return!t||"object"!==g(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function w(e){return(w=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function x(e,t){return(x=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var O=function(e){function t(e){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=m(this,w(t).call(this,e))).timeout=5e3,n.callback=null,n.isCompleted=!1,n.id="jso_passive_iframe_"+u.uuid();var r=window.addEventListener?"addEventListener":"attachEvent";window[r];return n.iframe=document.createElement("iframe"),n.iframe.setAttribute("id",n.id),n.iframe.setAttribute("src",e),n.iframe.addEventListener("load",function(e){var t=null;try{if(n.iframe.contentWindow.location.hash){var r=n.iframe.contentWindow.location.hash.substring(1);t=u.parseQueryString(r)}else if(n.iframe.contentWindow.location.search){var o=n.iframe.contentWindow.location.search.substring(1);t=u.parseQueryString(o)}null!==t?n._completed(t):n._failed(new Error("Failed to obtain response value from iframe"))}catch(e){}}),n}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&x(e,t)}(t,f),n=t,(r=[{key:"execute",value:function(){var e=this;return new Promise(function(t,n){e.callback=t,e.errorCallback=n,document.getElementsByTagName("body")[0].appendChild(e.iframe),setTimeout(function(){e._failed(new Error("Loading iframe timed out"))},e.timeout)})}},{key:"_cleanup",value:function(){var e=document.getElementById(this.id);e.parentNode.removeChild(e)}},{key:"_failed",value:function(e){this.isCompleted||(this.errorCallback&&"function"==typeof this.errorCallback&&this.errorCallback(e),this.isCompleted=!0,this._cleanup())}},{key:"_completed",value:function(e){this.isCompleted||(this.callback&&"function"==typeof this.callback&&this.callback(e),this.isCompleted=!0,this._cleanup())}}])&&b(n.prototype,r),o&&b(n,o),t}();function k(e){return(k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function j(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function S(e,t){return!t||"object"!==k(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function _(e){return(_=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function P(e,t){return(P=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var T=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),S(this,_(t).apply(this,arguments))}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&P(e,t)}(t,f),n=t,(r=[{key:"execute",value:function(){var e=this;return new Promise(function(t,n){window.popupCompleted=function(){var e=r.location.href;t(e)};var r=window.open(e.url,"jso-popup-auth","height=600,width=800");if(null===r)throw new Error("Error loading popup window");window.focus&&r.focus()})}}])&&j(n.prototype,r),o&&j(n,o),t}();function E(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var C=function(){function e(t){for(var n in function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t)this[n]=t[n]}var t,n,r;return t=e,(n=[{key:"set",value:function(e,t){return this[e]=t,this}}])&&E(t.prototype,n),r&&E(t,r),e}();function L(e){return(L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function R(e,t){return!t||"object"!==L(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function I(e){return(I=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function A(e,t){return(A=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var q=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),R(this,I(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&A(e,t)}(t,C),t}();function M(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var D=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.jso=t}var t,n,r;return t=e,(n=[{key:"_fetch",value:function(e,t){return fetch(e,t).then(function(e){if(401===e.status)throw new q;return e})}},{key:"fetch",value:function(e,t,n){var r=this;if((n=n||0)>2)throw new Error("Reccursion error. Expired tokens deleted and tried again multiple times.");var o={},i={mode:"cors"};return t&&(i=t,Object.assign(i,t)),t&&t.jso&&Object.assign(o,t.jso),this.jso.getToken(o).catch(function(e){console.error("Error fetching token to use ",e)}).then(function(o){return i.headers||(i.headers={}),i.headers.Authorization="Bearer "+o.access_token,r._fetch(e,i).catch(function(o){if(o instanceof q)return console.error("Token was expired. Deleting all tokens for this provider and get a new one",o),r.jso.wipeTokens(),r.fetch(e,t,n+1)})})}}])&&M(t.prototype,n),r&&M(t,r),e}();function V(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var z=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.jso=t,this.jquery=n}var t,n,r;return t=e,(n=[{key:"_fetch",value:function(e,t){var n=this;return new Promise(function(r,o){return t.done=r,t.fail=function(e,t,r){return 401===parseInt(t,10)?(n.jso.wipeTokens(),o(new q)):o(r)},n.jquery.ajax(e,t)})}},{key:"fetch",value:function(e,t,n){var r=this;if((n=n||0)>2)throw new Error("Reccursion error. Expired tokens deleted and tried again multiple times.");var o={},i={mode:"cors"};return t&&(i=t,Object.assign(i,t)),t&&t.jso&&Object.assign(o,t.jso),this.jso.getToken(o).catch(function(e){console.error("Error fetching token to use ",e)}).then(function(o){return i.headers||(i.headers={}),i.headers.Authorization="Bearer "+o.access_token,r._fetch(e,i).catch(function(o){if(o instanceof q)return console.error("Token was expired. Deleting all tokens for this provider and get a new one",o),r.jso.wipeTokens(),r.fetch(e,t,n+1)})})}}])&&V(t.prototype,n),r&&V(t,r),e}();function F(e){return(F="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function N(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function U(e,t){return!t||"object"!==F(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function J(e){return(J=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function B(e,t){return(B=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var G=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),U(this,J(t).apply(this,arguments))}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&B(e,t)}(t,C),n=t,(r=[{key:"toString",value:function(){return"OAuthResponseError: ["+(this.error||"unknown")+"]: "+(this.error_description||"unknown")}}])&&N(n.prototype,r),o&&N(n,o),t}();function H(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var W=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.config={};for(var t=0;t<arguments.length;t++)Object.assign(this.config,arguments[t])}var t,n,r;return t=e,(n=[{key:"has",value:function(e){var t=this.config,n=e.split("."),r=0;for(r=0;r<n.length;r++){if(!t.hasOwnProperty(n[r]))return!1;t=t[n[r]]}return!0}},{key:"getValue",value:function(e,t,n){n=n||!1;var r=this.config,o=e.split("."),i=0;for(i=0;i<o.length;i++){if(!r.hasOwnProperty(o[i])){r=void 0;break}r=r[o[i]]}if(void 0===r){if(n)throw new Error("Configuration option ["+o[i]+"] required but not provided.");return t}return r}}])&&H(t.prototype,n),r&&H(t,r),e}();function Q(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var K=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,(n=[{key:"on",value:function(e,t){this._callbacks||(this._callbacks={}),this._callbacks[e]||(this._callbacks[e]=[]),this._callbacks[e].push(t)}},{key:"emit",value:function(e){this._callbacks||(this._callbacks={}),this._callbacks[e]||(this._callbacks[e]=[]);for(var t=Array.prototype.slice.call(arguments,1),n=0;n<this._callbacks[e].length;n++)this._callbacks[e][n].apply(this,t)}}])&&Q(t.prototype,n),r&&Q(t,r),e}();function Y(e){return(Y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function X(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Z(e,t){return!t||"object"!==Y(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function $(e){return($=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ee(e,t){return(ee=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}n.d(t,"JSO",function(){return ne}),n.d(t,"BasicLoader",function(){return f}),n.d(t,"HTTPRedirect",function(){return y}),n.d(t,"Popup",function(){return T}),n.d(t,"IFramePassive",function(){return O}),n.d(t,"Fetcher",function(){return D}),n.d(t,"FetcherJQuery",function(){return z});n(97);var te={lifetime:3600},ne=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=Z(this,$(t).call(this))).configure(e),n.providerID=n.getProviderID(),n.Loader=y,n.store=a,n.callbacks={},n.config.getValue("debug",!1)&&(u.debug=!0),n}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ee(e,t)}(t,K),n=t,(r=[{key:"configure",value:function(e){this.config=new W(te,e)}},{key:"setStore",value:function(e){this.store=e}},{key:"setLoader",value:function(e){if("function"!=typeof e)throw new Error("loader MUST be an instance of the JSO BasicLoader");this.Loader=e}},{key:"getProviderID",value:function(){var e=this.config.getValue("providerID",null);if(null!==e)return e;var t=this.config.getValue("client_id",null,!0);return this.config.getValue("authorization",null,!0)+"|"+t}},{key:"processTokenResponse",value:function(e){var t;if(!e.state)throw new Error("Could not get state from storage.");if(!(t=this.store.getState(e.state)))throw new Error("Could not retrieve state");if(!t.providerID)throw new Error("Could not get providerid from state");return u.log("processTokenResponse ",e,""),this.processReceivedToken(e,t)}},{key:"processReceivedToken",value:function(e,t){var n=u.epoch();return e.received=n,e.expires_in?(e.expires=n+parseInt(e.expires_in,10),e.expires_in=parseInt(e.expires_in,10)):!1===this.config.getValue("default_lifetime",null)?e.expires=null:this.config.has("permanent_scope")?this.store.hasScope(e,this.config.getValue("permanent_scope"))||(e.expires=null):this.config.has("default_lifetime")?e.expires=n+this.config.getValue("default_lifetime"):e.expires=n+3600,e.scope?(e.scopes=e.scope.split(" "),delete e.scope):t.scopes?e.scopes=t.scopes:e.scopes=[],u.log("processTokenResponse completed ",e,""),this.store.saveToken(t.providerID,e),t.restoreHash?window.location.hash=t.restoreHash:window.location.hash="",e}},{key:"processAuthorizationCodeResponse",value:function(e){var t,n=this;if(console.log(this),this.emit("authorizationCode",e),!e.state)throw new Error("Could not find state paramter from callback.");if(null===(t=this.store.getState(e.state)))throw new Error("Could not find retrieve state object.");if(console.log("state",t),this.config.has("token")){if(!this.config.has("client_secret"))throw new Error("Configuration missing [client_secret]");var r=new Headers;r.append("Authorization","Basic "+btoa(this.config.getValue("client_id")+":"+this.config.getValue("client_secret"))),r.append("Content-Type","application/x-www-form-urlencoded;charset=UTF-8");var o={grant_type:"authorization_code",code:e.code};t.hasOwnProperty("redirect_uri")&&(o.redirect_uri=t.redirect_uri);var i={mode:"cors",headers:r,method:"POST",body:u.encodeQS(o)};return fetch(this.config.getValue("token"),i).then(function(e){return e.json()}).then(function(e){return u.log("Received response on token endpoint ",e,""),n.processReceivedToken(e,t)})}u.log("Received an authorization code. Will not process it as the config option [token] endpoint is not set. If you would like to process the code yourself, please subscribe to the [authorizationCode] event")}},{key:"processErrorResponse",value:function(e){var t;if(!e.state)throw new Error("Could not get [state] and no default providerid is provided.");if(!(t=this.store.getState(e.state)))throw new Error("Could not retrieve state");if(!t.providerID)throw new Error("Could not get providerid from state");return t.restoreHash?window.location.hash=t.restoreHash:window.location.hash="",new G(e)}},{key:"callback",value:function(e){var t=null;if("object"===Y(e))t=e;else if("string"==typeof e)t=u.getResponseFromURL(e);else{if(void 0!==e)return;t=u.getResponseFromURL(window.location.href)}if(u.log("Receving response in callback",t),t.hasOwnProperty("access_token"))return this.processTokenResponse(t);if(t.hasOwnProperty("code"))return this.processAuthorizationCodeResponse(t);if(t.hasOwnProperty("error"))throw this.processErrorResponse(t)}},{key:"dump",value:function(){var e=this.store.getTokens(this.providerID);return{providerID:this.providerID,tokens:e,config:this.config}}},{key:"_getRequestScopes",value:function(e){var t,n=[];if(this.config.has("scopes.request")){var r=this.config.getValue("scopes.request");for(t=0;t<r.length;t++)n.push(r[t])}if(e&&e.scopes&&e.scopes.request)for(t=0;t<e.scopes.request.length;t++)n.push(e.scopes.request[t]);return u.uniqueList(n)}},{key:"_getRequiredScopes",value:function(e){var t,n=[];if(this.config.has("scopes.require")){var r=this.config.getValue("scopes.require");for(t=0;t<r.length;t++)n.push(r[t])}if(e&&e.scopes&&e.scopes.require)for(t=0;t<e.scopes.require.length;t++)n.push(e.scopes.require[t]);return u.uniqueList(n)}},{key:"getToken",value:function(e){var t=this;return e=e||{},new Promise(function(n,r){var o=t._getRequiredScopes(e),i=t.store.getToken(t.providerID,o);if(i)return n(i);if(e.hasOwnProperty("allowredir")&&!e.allowredir)throw new Error("Cannot obtain a token, when not allowed to redirect...");n(t._authorize(e))})}},{key:"checkToken",value:function(e){var t=this._getRequiredScopes(e);return this.store.getToken(this.providerID,t)}},{key:"_authorize",value:function(e){var t,n,r,i=this;return Promise.resolve().then(function(){var c,a=i.config.getValue("authorization",null,!0),s=i.config.getValue("client_id",null,!0);if(e.hasOwnProperty("allowia")||i.config.has("allowia"))throw new Error('The allowia option was removed in JSO 4.1.0. Instead use {request: {prompt: "none"}}');if(u.log("About to send an authorization request to this endpoint",a),u.log("Options",e),t={},i.config.has("request")){var f=i.config.getValue("request");t=o()(t,f)}if(e.hasOwnProperty("request")&&(t=o()(t,e.request)),t.response_type=e.response_type||i.config.getValue("response_type","id_token token"),t.state=u.uuid(),i.config.has("redirect_uri")&&(t.redirect_uri=i.config.getValue("redirect_uri","")),e.redirect_uri&&(t.redirect_uri=e.redirect_uri),t.client_id=s,c=(r=i._getRequestScopes(e)).includes("openid"),r.length>0&&(t.scope=u.scopeList(r)),u.log("Running in mode: "+(c?"OpenID Connect mode":"OAuth mode")),c&&!t.hasOwnProperty("redirect_uri"))throw new Error("An OpenID Request requires a redirect_uri to be set. Please add to configuration. A redirect_uri is not required for plain OAuth");c&&(t.nonce=u.uuid()),u.log("Debug Authentication request object",JSON.stringify(t,void 0,2)),n=u.encodeURL(a,t),window.location.hash&&(t.restoreHash=window.location.hash),t.providerID=i.providerID,r&&(t.scopes=r),u.log("Saving state ["+t.state+"]"),u.log(JSON.parse(JSON.stringify(t)));var l=i.Loader;return e.hasOwnProperty("loader")&&(l=e.loader),u.log("Looking for loader",e,l),i.store.saveState(t.state,t),i.gotoAuthorizeURL(n,l).then(function(e){if(!0!==e)return i.callback(e)})})}},{key:"gotoAuthorizeURL",value:function(e,t){return new Promise(function(n,r){if(null!==t&&"function"==typeof t){var o=new t(e);if(!(o instanceof f))throw new Error("JSO selected Loader is not an instance of BasicLoader.");n(o.execute())}else r(new Error("Cannot redirect to authorization endpoint because of missing redirect handler"))})}},{key:"wipeTokens",value:function(){this.store.wipeTokens(this.providerID)}}])&&X(n.prototype,r),i&&X(n,i),t}()}])});
//# sourceMappingURL=jso.js.map